version: 1
applications:
- appRoot: tma
  backend:
    phases:
      build:
        commands:
          - npm install --cache .npm --prefer-offline
          - echo "Deploying branch ${AWS_BRANCH} for app ${AWS_APP_ID}"
          - npx ampx pipeline-deploy --branch "${AWS_BRANCH}" --app-id "${AWS_APP_ID}"
  frontend:
    phases:
      preBuild:
        commands:
          - npm install --cache .npm --prefer-offline
      build:
        commands:
          - npm run build
    artifacts:
      baseDirectory: .next
      files:
        - '**/*'
    cache:
      paths:
        - .npm/**/*
        - node_modules/**/*
        - .next/cache/**/*
